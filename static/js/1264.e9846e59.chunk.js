"use strict";(self.webpackChunkcity_walk_app=self.webpackChunkcity_walk_app||[]).push([[1264],{44230:(t,n,e)=>{e.d(n,{C:()=>u,Cr:()=>g,H6:()=>l,_I:()=>p,dz:()=>v,fA:()=>a,kb:()=>h,ld:()=>_,sd:()=>f,vt:()=>d});var o=e(15941),i=e(97467),s=e(20664),r=e(9392),c=e(75762);function d(t){return t?{origin:(0,r.o8)(t.origin),vector:(0,r.o8)(t.vector)}:{origin:(0,r.vt)(),vector:(0,r.vt)()}}function u(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d();return a(t.origin,t.vector,n)}function a(t,n){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d();return(0,s.c)(e.origin,t),(0,s.c)(e.vector,n),e}function g(t,n){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d();return(0,s.c)(e.origin,t),(0,s.d)(e.vector,n,t),e}function h(t,n){const e=(0,s.d)(c.rq.get(),n,t.origin),i=(0,s.f)(t.vector,e),r=(0,s.f)(t.vector,t.vector),d=(0,o.qE)(i/r,0,1),u=(0,s.d)(c.rq.get(),(0,s.h)(c.rq.get(),t.vector,d),e);return(0,s.f)(u,u)}function p(t,n,e){return l(t,n,0,1,e)}function f(t,n,e){return(0,s.g)(e,t.origin,(0,s.h)(e,t.vector,n))}function l(t,n,e,i,r){const{vector:d,origin:u}=t,a=(0,s.d)(c.rq.get(),n,u),g=(0,s.f)(d,a)/(0,s.k)(d);return(0,s.h)(r,d,(0,o.qE)(g,e,i)),(0,s.g)(r,r,t.origin)}function v(t,n){if(b(t,function(t,n){const e=C.get();return e.origin=t,e.vector=n,e}(n.origin,n.direction),!1,m)){const{tA:n,pB:e,distance2:o}=m;if(n>=0&&n<=1)return o;if(n<0)return(0,s.s)(t.origin,e);if(n>1)return(0,s.s)((0,s.g)(c.rq.get(),t.origin,t.vector),e)}return null}function _(t,n,e){return!!b(t,n,!0,m)&&((0,s.c)(e,m.pA),!0)}function b(t,n,e,i){const r=1e-6,d=t.origin,u=(0,s.g)(c.rq.get(),d,t.vector),a=n.origin,g=(0,s.g)(c.rq.get(),a,n.vector),h=c.rq.get(),p=c.rq.get();if(h[0]=d[0]-a[0],h[1]=d[1]-a[1],h[2]=d[2]-a[2],p[0]=g[0]-a[0],p[1]=g[1]-a[1],p[2]=g[2]-a[2],Math.abs(p[0])<r&&Math.abs(p[1])<r&&Math.abs(p[2])<r)return!1;const f=c.rq.get();if(f[0]=u[0]-d[0],f[1]=u[1]-d[1],f[2]=u[2]-d[2],Math.abs(f[0])<r&&Math.abs(f[1])<r&&Math.abs(f[2])<r)return!1;const l=h[0]*p[0]+h[1]*p[1]+h[2]*p[2],v=p[0]*f[0]+p[1]*f[1]+p[2]*f[2],_=h[0]*f[0]+h[1]*f[1]+h[2]*f[2],b=p[0]*p[0]+p[1]*p[1]+p[2]*p[2],m=(f[0]*f[0]+f[1]*f[1]+f[2]*f[2])*b-v*v;if(Math.abs(m)<r)return!1;let C=(l*v-_*b)/m,q=(l+v*C)/b;e&&(C=(0,o.qE)(C,0,1),q=(0,o.qE)(q,0,1));const w=c.rq.get(),E=c.rq.get();return w[0]=d[0]+C*f[0],w[1]=d[1]+C*f[1],w[2]=d[2]+C*f[2],E[0]=a[0]+q*p[0],E[1]=a[1]+q*p[1],E[2]=a[2]+q*p[2],i.tA=C,i.tB=q,i.pA=w,i.pB=E,i.distance2=(0,s.s)(w,E),!0}const m={tA:0,tB:0,pA:(0,r.vt)(),pB:(0,r.vt)(),distance2:0},C=new i.I((()=>d()))},51264:(t,n,e)=>{e.r(n),e.d(n,{default:()=>f});var o=e(35143),i=e(50346),s=(e(76460),e(81806),e(47249),e(50076),e(85842)),r=e(20664),c=e(9392),d=e(44230),u=e(78315),a=e(94536),g=e(2259);function h(t,n,e){const o=(0,u.c)(),i=(0,u.a)(o);return(0,r.b)(i,i,t,.5),(0,r.b)(i,i,n,.5),o[3]=(0,r.j)(i,t),(0,r.g)(i,i,e),o}let p=class{constructor(){this._idToComponent=new Map,this._components=new a.A((t=>t.bounds)),this._edges=new a.A((t=>t.bounds)),this._tmpLineSegment=(0,d.vt)(),this._tmpP1=(0,c.vt)(),this._tmpP2=(0,c.vt)(),this._tmpP3=(0,c.vt)(),this.remoteClient=null}async fetchCandidates(t,n){await Promise.resolve(),(0,i.Te)(n),await this._ensureEdgeLocations(t,n);const e=[];return this._edges.forEachNeighbor((n=>(this._addCandidates(t,n,e),e.length<1e3)),t.bounds),{result:{candidates:e}}}async _ensureEdgeLocations(t,n){const e=[];if(this._components.forEachNeighbor((t=>{if(null==t.info){const{id:n,uid:o}=t;e.push({id:n,uid:o})}return!0}),t.bounds),!e.length)return;const o={components:e},i=await this.remoteClient.invoke("fetchAllEdgeLocations",o,n??{});for(const s of i.components)this._setFetchEdgeLocations(s)}async add(t){const n=new v(t.id,t.bounds);return this._idToComponent.set(n.id,n),this._components.add([n]),{result:{}}}async remove(t){const n=this._idToComponent.get(t.id);if(n){const t=[];this._edges.forEachNeighbor((e=>(e.component===n&&t.push(e),!0)),n.bounds),this._edges.remove(t),this._components.remove([n]),this._idToComponent.delete(n.id)}return{result:{}}}_setFetchEdgeLocations(t){const n=this._idToComponent.get(t.id);if(null==n||t.uid!==n.uid)return;const e=g.HY.createView(t.locations),o=new Array(e.count),i=(0,c.vt)(),s=(0,c.vt)();for(let c=0;c<e.count;c++){e.position0.getVec(c,i),e.position1.getVec(c,s);const r=h(i,s,t.origin),d=new _(n,c,r);o[c]=d}this._edges.add(o);const{objectIds:r,origin:d}=t;n.info={locations:e,objectIds:r,origin:d}}_addCandidates(t,n,e){const{info:o}=n.component,{origin:i,objectIds:s}=o,c=o.locations,d=c.position0.getVec(n.index,this._tmpP1),u=c.position1.getVec(n.index,this._tmpP2);(0,r.g)(d,d,i),(0,r.g)(u,u,i);const a=s[c.componentIndex.get(n.index)];this._addEdgeCandidate(t,a,d,u,e),l(t,a,d,e),l(t,a,u,e)}_addEdgeCandidate(t,n,e,o,i){if(!t.returnEdge)return;const s=(0,u.a)(t.bounds),a=(0,d.Cr)(e,o,this._tmpLineSegment),g=(0,d._I)(a,s,this._tmpP3);(0,u.o)(t.bounds,g)&&i.push({type:"edge",objectId:n,target:(0,c.o8)(g),distance:(0,r.j)(s,g),start:(0,c.o8)(e),end:(0,c.o8)(o)})}};p=(0,o._)([(0,s.$)("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],p);const f=p;function l(t,n,e,o){if(!t.returnVertex||!(0,u.o)(t.bounds,e))return;const i=(0,u.a)(t.bounds);o.push({type:"vertex",objectId:n,target:(0,c.o8)(e),distance:(0,r.j)(i,e)})}class v{constructor(t,n){this.id=t,this.bounds=n,this.info=null,this.uid=++v.uid}}v.uid=0;class _{constructor(t,n,e){this.component=t,this.index=n,this.bounds=e}}}}]);
//# sourceMappingURL=1264.e9846e59.chunk.js.map