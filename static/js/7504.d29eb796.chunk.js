"use strict";(self.webpackChunkcity_walk_app=self.webpackChunkcity_walk_app||[]).push([[7504],{87504:(e,t,i)=>{i.r(t),i.d(t,{default:()=>G});var r=i(70273),s=i(50636),h=i(80757),a=i(13741),n=i(82439),o=i(73896),l=i(67519),p=(i(27052),i(11434),i(55292)),d=i(58638),c=i(51468),g=i(40516),u=i(54196),_=i(38726),w=i(53748),y=i(53677),f=i(51163),m=i(17520),k=i(47618),A=i(17302);const M=["route-info","direction-line","direction-point","polygon-barrier","polyline-barrier","point-barrier","stop"],I={graphic:null,property:null,oldValue:null,newValue:null};function H(e){return e instanceof d.A||e instanceof c.A||e instanceof g.A||e instanceof u.A||e instanceof _.A||e instanceof w.A||e instanceof y.A}const V=new Set(["default"]);let v=class extends((0,f.e)(A.A)){constructor(){super(...arguments),this._graphics=new h.A,this._highlightIds=new Map,this._networkFeatureMap=new Map,this._networkGraphicMap=new Map}get _routeItems(){return new a.A({getCollections:()=>null==this.layer||this.destroyed?[]:[null!=this.layer.routeInfo?new h.A([this.layer.routeInfo]):null,this.layer.directionLines,this.layer.directionPoints,this.layer.polygonBarriers,this.layer.polylineBarriers,this.layer.pointBarriers,this.layer.stops]})}initialize(){this._updatingHandles.addOnCollectionChange((()=>this._routeItems),(e=>this._routeItemsChanged(e)),o.Vh)}destroy(){this._networkFeatureMap.clear(),this._networkGraphicMap.clear(),this._graphics.removeAll(),this._get("_routeItems")?.destroy()}attach(){this._createGraphicsView()}detach(){this._destroyGraphicsView()}async fetchPopupFeaturesAtLocation(e,t){return this._graphicsView.hitTest(e).filter((e=>{let{popupTemplate:t}=e;return!!t}))}highlight(e){let t;t=H(e)?[this._getNetworkFeatureUid(e)]:function(e){return Array.isArray(e)&&e.length>0&&H(e[0])}(e)?e.map((e=>this._getNetworkFeatureUid(e))):function(e){return h.A.isCollection(e)&&e.length&&H(e.at(0))}(e)?e.map((e=>this._getNetworkFeatureUid(e))).toArray():[e.uid];const i=t.filter(s.Ru);return i.length?(this._addHighlight(i),(0,n.hA)((()=>this._removeHighlight(i)))):(0,n.hA)()}async hitTest(e,t){if(this.suspended)return null;const i=this._graphicsView.hitTest(e).filter(s.Ru).map((e=>this._networkGraphicMap.get(e)));if(!i.length)return null;const{layer:r}=this;return i.reverse().map((t=>({type:"route",layer:r,mapPoint:e,networkFeature:t})))}isUpdating(){return this._graphicsView.updating}moveEnd(){}update(e){this._graphicsView.processUpdate(e)}viewChange(){this._graphicsView.viewChange()}_addHighlight(e){for(const t of e)if(this._highlightIds.has(t)){const e=this._highlightIds.get(t);this._highlightIds.set(t,e+1)}else this._highlightIds.set(t,1);this._updateHighlight()}_createGraphic(e){const t=e.toGraphic();return t.layer=this.layer,t.sourceLayer=this.layer,t}_createGraphicsView(){const e=this.view,t=new m.A(e.featuresTilingScheme);this._graphicsView=new k.A({container:t,graphics:this._graphics,requestUpdateCallback:()=>this.requestUpdate(),view:e}),this.container.addChild(t),this._updateHighlight()}_destroyGraphicsView(){this.container.removeChild(this._graphicsView.container),this._graphicsView.destroy()}_getDrawOrder(e){const t=this._networkGraphicMap.get(e);return M.indexOf(t.type)}_getNetworkFeatureUid(e){return this._networkFeatureMap.has(e)?this._networkFeatureMap.get(e).uid:null}_removeHighlight(e){for(const t of e)if(this._highlightIds.has(t)){const e=this._highlightIds.get(t)-1;0===e?this._highlightIds.delete(t):this._highlightIds.set(t,e)}this._updateHighlight()}_routeItemsChanged(e){if(e.removed.length){this._graphics.removeMany(e.removed.map((e=>{const t=this._networkFeatureMap.get(e);return this._networkFeatureMap.delete(e),this._networkGraphicMap.delete(t),t})));for(const t of e.removed)this.removeHandles(t)}if(e.added.length){this._graphics.addMany(e.added.map((e=>{const t=this._createGraphic(e);return null==t.symbol?null:(this._networkFeatureMap.set(e,t),this._networkGraphicMap.set(t,e),t)})).filter(s.Ru));for(const t of e.added)this.addHandles([(0,o.wB)((()=>t.geometry),((e,i)=>{this._updateGraphic(t,"geometry",e,i)})),(0,o.wB)((()=>t.symbol),((e,i)=>{this._updateGraphic(t,"symbol",e,i)}))],t);this._graphics.sort(((e,t)=>this._getDrawOrder(e)-this._getDrawOrder(t)))}}_updateGraphic(e,t,i,r){if(!this._networkFeatureMap.has(e)){const t=this._createGraphic(e);return this._networkFeatureMap.set(e,t),this._networkGraphicMap.set(t,e),void this._graphics.add(t)}const s=this._networkFeatureMap.get(e);s[t]=i,I.graphic=s,I.property=t,I.oldValue=r,I.newValue=i,this._graphicsView.graphicUpdateHandler(I)}_updateHighlight(){const e=Array.from(this._highlightIds.keys()),t=this._getHighlightBits(V);this._graphicsView.setHighlight(e.map((e=>({objectId:e,highlightFlags:t}))))}};(0,r._)([(0,l.MZ)()],v.prototype,"_graphics",void 0),(0,r._)([(0,l.MZ)()],v.prototype,"_routeItems",null),v=(0,r._)([(0,p.$)("esri.views.2d.layers.RouteLayerView2D")],v);const G=v},17520:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(58261),s=i(38473),h=i(30260);class a extends s.f{renderChildren(e){for(const t of this.children)t.setTransform(e.state);if(super.renderChildren(e),this._updateAttributeView(),this.children.some((e=>e.hasData))){switch(e.drawPhase){case r.S5.MAP:this._renderChildren(e,r.RI.All);break;case r.S5.HIGHLIGHT:this.hasHighlight&&this._renderHighlight(e)}this._boundsRenderer&&this._boundsRenderer.doRender(e)}}_renderHighlight(e){(0,h.lB)(e,!1,(e=>{this._renderChildren(e,r.RI.Highlight)}))}}}}]);
//# sourceMappingURL=7504.d29eb796.chunk.js.map